<section class="py-10 text-neutral-800 dark:text-neutral-200">

  <!-- Header -->
  <div class="mx-auto max-w-6xl px-4 flex items-center justify-between mb-8">
    <h2 class="text-3xl font-bold text-cyan-600 dark:text-cyan-300">ğŸ’¬ Sugerencias</h2>

    <button
      class="rounded-xl bg-cyan-400 dark:bg-cyan-300 px-5 py-2 font-semibold text-neutral-900"
      (click)="abrirModal()">
      â• Nueva sugerencia
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-16">
    <span class="text-lg">Cargando...</span>
  </div>

  <!-- Lista / Contenedor -->
  <div class="mx-auto max-w-6xl space-y-6">

    <!-- ğŸ”¹ Recuadro cuando no hay sugerencias (SIN BOTÃ“N) -->
    <div *ngIf="!loading && sugerencias.length === 0"
         class="rounded-2xl bg-white dark:bg-neutral-900 ring-1 ring-neutral-300/60 dark:ring-neutral-800 shadow-lg p-8 text-center">

      <h3 class="text-xl font-semibold text-neutral-700 dark:text-neutral-300">
        No hay sugerencias registradas
      </h3>

      <p class="text-neutral-500 dark:text-neutral-400 mt-2">
        Cuando se envÃ­en sugerencias aparecerÃ¡n aquÃ­.
      </p>
    </div>

    <!-- ğŸ”¹ Lista de sugerencias -->
    <details *ngFor="let s of sugerencias"
             class="group rounded-2xl bg-white dark:bg-neutral-900 ring-1 ring-neutral-300/60 dark:ring-neutral-800 shadow-lg overflow-hidden">

      <summary class="list-none cursor-pointer px-5 py-4 flex justify-between items-center">
        <div class="flex items-center gap-4">
          <span class="text-sm text-neutral-500">#{{ s.id }}</span>
          <span class="font-semibold">{{ s.asunto }}</span>
        </div>

        <div class="flex items-center gap-4">
          <span class="text-sm text-neutral-600 dark:text-neutral-400">
            {{ s.fechaEnvio | date:'medium' }}
          </span>

          <span class="rounded-full px-3 py-1 text-xs ring-1"
            [ngClass]="{
              'bg-amber-100 text-amber-700 ring-amber-300': s.estado === 'pendiente',
              'bg-blue-100 text-blue-700 ring-blue-300': s.estado === 'revisado',
              'bg-emerald-100 text-emerald-700 ring-emerald-300': s.estado === 'resuelto',
              'bg-rose-100 text-rose-700 ring-rose-300': s.estado === 'descartado'
            }">
            {{ s.estado }}
          </span>
        </div>
      </summary>

      <!-- Contenido expandido -->
      <div class="px-6 pb-6 pt-2 space-y-4 border-t border-neutral-300/40">

        <!-- EdiciÃ³n inline -->
        <div *ngIf="editId === s.id; else mostrarDatos" class="space-y-3">
          <input type="text" [(ngModel)]="editAsunto"
                 class="w-full p-2 rounded ring-1 bg-neutral-100 dark:bg-neutral-800"
                 placeholder="Asunto">

          <textarea [(ngModel)]="editMensaje"
                    class="w-full p-2 h-28 rounded ring-1 bg-neutral-100 dark:bg-neutral-800"
                    placeholder="Mensaje"></textarea>

          <div class="flex gap-3">
            <button class="px-4 py-2 rounded-xl bg-emerald-400 text-neutral-900 font-semibold"
                    (click)="guardarEdicion(s.id)">Guardar</button>

            <button class="px-4 py-2 rounded-xl bg-neutral-300 dark:bg-neutral-700"
                    (click)="cancelarEdicion()">Cancelar</button>
          </div>
        </div>

        <!-- Datos normales -->
        <ng-template #mostrarDatos>
          <p class="text-neutral-700 dark:text-neutral-300 whitespace-pre-line">{{ s.mensaje }}</p>

          <!-- Cambio de estado -->
          <div class="flex items-center gap-3">
            <label class="text-sm">Cambiar estado:</label>

            <select class="p-2 rounded bg-neutral-100 dark:bg-neutral-800"
                    [(ngModel)]="s.estado"
                    (change)="cambiarEstadoLocal(s, s.estado)">
              <option *ngFor="let e of estados" [value]="e">{{ e }}</option>
            </select>
          </div>

          <!-- Botones -->
          <div class="flex gap-3 pt-4">
            <button class="px-4 py-2 rounded-xl bg-cyan-400 dark:bg-cyan-300 text-neutral-900 font-semibold"
                    (click)="iniciarEdicion(s)">Editar</button>

            <button class="px-4 py-2 rounded-xl bg-rose-400 text-white font-semibold"
                    (click)="eliminar(s.id)">Eliminar</button>
          </div>
        </ng-template>

      </div>
    </details>

  </div>

</section>

<!-- Modal creaciÃ³n -->
<div *ngIf="mostrarModal"
     class="fixed inset-0 bg-black/40 flex justify-center items-center z-50">

  <div class="bg-white dark:bg-neutral-900 p-6 rounded-2xl shadow-xl w-96 animate-fade">

    <h3 class="text-xl font-semibold mb-4">Nueva sugerencia</h3>

    <input type="text" [(ngModel)]="nuevoAsunto"
           class="w-full p-2 mb-3 rounded ring-1 bg-neutral-100 dark:bg-neutral-800"
           placeholder="Asunto">

    <textarea [(ngModel)]="nuevoMensaje"
              class="w-full p-2 h-28 mb-4 rounded ring-1 bg-neutral-100 dark:bg-neutral-800"
              placeholder="Mensaje"></textarea>

    <div class="flex justify-end gap-3">
      <button class="px-4 py-2 rounded-xl bg-neutral-300 dark:bg-neutral-700"
              (click)="cerrarModal()">Cancelar</button>

      <button class="px-4 py-2 rounded-xl bg-cyan-400 dark:bg-cyan-300 text-neutral-900 font-semibold"
              (click)="crearSugerencia()">Crear</button>
    </div>

  </div>
</div>
